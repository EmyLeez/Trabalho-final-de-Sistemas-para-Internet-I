<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bibliotaku</title>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <script src="js/jquery.js"></script>
</head>
<body>

    <!-- O Header conterá o cabeçalho do projeto -->
    <header>
        <!-- Definindo a parte de cima do cabeçalho -->
        <div class="cabecalho_pix">
            <img src="assets/cabecalho.png"/>
        </div>

        <!-- Definindo a parte do meio do cabeçalho -->
        <div class="cabecalho_meio">
            <img src="assets/logo.png"/>
            <div class="texto_no_meio">
                <h1>Bem-vindo a nossa loja!</h1>
            </div>
            <img src="assets/naruto.png" id="naruto"/>
        </div>

        <div class="cabecalho_navegacao">
            <nav>
                <ul>

                    <!-- Casa branca pra referenciar na barra horizontal -->
                    <li class="book"><a href="tela_inicial.html"><img src="assets/whitehouse.png"></a></li>

                    <!-- Abrindo categorias de Página Inicial -->
                    <li class="inicial">
                        Página Inicial
                    </li>

                    <!-- Define as funções para movimentação de mouse em cima da aba de categorias -->
                    <script>
                        $(document).ready(function() {
                          $(".categorias").hover(
                            function() {
                              $("#categoriasShow").show();
                            },
                            function() {
                              $("#categoriasShow").hide();
                            }
                          );
                        });
                    </script>

                    <!-- Abrindo categorias de anime (apenas estilização) -->
                    <li class="categorias">
                        Mangás <img src="assets/seta.png"/>
                        <ul class="show-content" id="categoriasShow">
                            <li><a href="#">Ação</a></li>
                            <li><a href="#">Shoujo</a></li>
                            <li><a href="#">Romance</a></li>
                        </ul>
                    </li>

                    <!-- Define as funções para movimentação de mouse em cima da aba de categorias -->
                    <script>
                        $(document).ready(function() {
                          $(".categorias").hover(
                            function() {
                              $("#categoriasShow").show();
                            },
                            function() {
                              $("#categoriasShow").hide();
                            }
                          );
                        });
                    </script>

                    <!-- Abrindo categoria de Livros -->
                    <li class="livros">
                        Livros <img src="assets/seta.png"/>
                        <ul class="show-content" id="livrosShow">
                            <li><a href="#">Ação</a></li>
                            <li><a href="#">Terror</a></li>
                            <li><a href="#">Romance</a></li>
                        </ul>
                    </li>

                    <!-- Define as funções para movimentação de mouse em cima da aba de livros -->
                    <script>
                        $(document).ready(function() {
                          $(".livros").hover(
                            function() {
                              $("#livrosShow").show();
                            },
                            function() {
                              $("#livrosShow").hide();
                            }
                          );
                        });
                    </script>

                    <li class="inicial">
                        Fale Conosco
                    </li>
                </ul>
            </nav>
        </div>
    </header>

   <!-- Definindo a parte central do projeto. -->

    <div class="produto-container">

        <!-- Primeiro Produto -->
        <div class="produto">
            <img src="assets/manga_naruto1.jpg">
            <h2>Mangá do Naruto Vol 1</h2>
            <p>Valor: R$ 36,90</p>
            <button class="botao-compra" preco="36.90" nome_produto="Mangá do Naruto Vol 1" onclick="mostrarOpcoesPagamento(this)">Comprar</button>
        </div>

        <!-- Segundo Produto -->
        <div class="produto">
            <img src="assets/manga_kimi1.jpg">
            <h2>Kimi ni Todoke Vol 1</h2>
            <p>Valor: R$ 36,90</p>
            <button class="botao-compra" preco="36.90" nome_produto="Kimi ni Todoke Vol 1" onclick="mostrarOpcoesPagamento(this)">Comprar</button>
        </div>

        <!-- Terceiro Produto -->
        <div class="produto">
            <img src="assets/lendarios_livro1.jpg">
            <h2>Livro Lendarios Vol 1</h2>
            <p>Valor: R$ 50,90</p>
            <button class="botao-compra" preco="50.90" nome_produto="Livro Lendários Vol 1" onclick="mostrarOpcoesPagamento(this)">Comprar</button>
        </div>

        <!-- Quarto Produto -->
        <div class="produto">
            <img src="assets/eleanor_livro1.jpg">
            <h2>Livro Eleanor Vol 1</h2>
            <p>Valor: R$ 50,90</p>
            <button class="botao-compra" preco="50.90" nome_produto="Livro Eleanor Vol 1" onclick="mostrarOpcoesPagamento(this)">Comprar</button>
        </div>

        <!-- Quinto Produto -->
        <div class="produto">
            <img src="assets/manga_psycho1.jpg">
            <h2>Mangá Psycho Pass</h2>
            <p>Valor: R$ 36,90</p>
            <button class="botao-compra" preco="36.90" nome_produto="Mangá Psycho Pass" onclick="mostrarOpcoesPagamento(this)">Comprar</button>
        </div>
    </div>

    <div class="produto-pagamento">
        <!-- Seção para informações do PIX -->

        <form id="formu-pagamento">

            <div class="opcoes-pagamento">
                <!-- Conteúdo das opções de pagamento -->
                <p>Produto Selecionado: <b><span class="nome-produto"></span></b></p>
                <p><b>Selecione a forma de pagamento:</b></p>
                <label>
                    <input type="radio" name="metodoPagamento" value="pix"> PIX
                </label>
                <label>
                    <input type="radio" name="metodoPagamento" value="cartao"> Cartão de Crédito
                </label><br>
                <!-- <button onclick="efetuarCompra(this)">Confirmar Compra</button> -->
            </div>
            
            <div class="secao-pix">
                <br>
                <label for="nomePix">Nome Completo: </label>
                <input type="text" id="nomePix" required><br><br>
                <label for="cpfPix">CPF: </label>
                <input type="text" id="cpfPix" title="Formato esperado: 000.000.000-00" required><br><br>
                <button type="submit">Enviar</button>
            </div>

            <!-- Seção para informações do Cartão -->
            <div class="secao-cartao">
                <label for="nomeTitular">Nome do Titular:</label>
                <input type="text" id="nomeTitular" required>
        
                <label for="cartaoNumero">Número do Cartão:</label>
                <input type="text" id="cartaoNumero" pattern="\d{4} \d{4} \d{4} \d{4}" title="Formato esperado: 1234 5678 9123 0000" required><img id="visaBandeira" src="assets/visa.png"> <img id="mastercardBandeira" src="assets/mastercard.png">

                <label for="validadeCartao">Validade do Cartão (mm/aa):</label>
                <input type="text" id="validadeCartao" pattern="\d{2}/\d{2}" title="Formato esperado: mm/aa" required>
        
                <label for="segurancaCodigo">Código de Segurança:</label>
                <input type="text" id="segurancaCodigo" pattern="\d{3}" title="Formato esperado: 123" required>
        
                <label for="parcelamento">Opção de Parcelamento:</label>
                <select id="parcelamento" required>
                    <option value="1">1x de R$ XX</option>
                    <option value="2">2x de R$ XX</option>
                    <option value="3">3x de R$ XX (Sem juros)</option>
                    <option value="4">4x de R$ XX (Com juros)</option>
                    <option value="5">5x de R$ XX (Com juros)</option>
                </select>
        
                <button type="submit">Confirmar Pagamento</button>
            </div>


        </form>

        <script>
            $(document).ready(function () {
                $(".botao-compra").click(function () {
                    $(".secao-pix, .secao-cartao").hide();
                    $("#nomePix, #cpfPix, #nomeCartao, #numeroCartao, #validadeCartao, #parcelamentoCartao").val("");

                    // Pegando dados do produto selecionado a partir do clique no botão do usuário. A finalidade é mostrar para o usuário qual o produto que ele selecionou.
                    var nomeDoProduto = $(this).attr("nome_produto");

                    // Pegando preço do produto
                    var precoDoProduto = parseFloat($(this).attr("preco"));

                    // Permite a visualização do nome do produto.
                    $(".nome-produto").text(nomeDoProduto);

                    // Permite a visualização dos métodos de pagamento.
                    $(".opcoes-pagamento").toggle();

                    $("#parcelamento").empty();

                    for (var i = 1; i <= 5; i++) {
                        var valorParcela = precoDoProduto / i;
                        var mensagem = i <= 3 ? `(Sem juros)` : `(Com juros de 3% ao mês)`;
                        var optionText = `${i}x de R$ ${valorParcela.toFixed(2)} ${mensagem}`;
                        var option = $("<option>", { value: i, text: optionText });
                        $("#parcelamento").append(option);
                    }
                });

                $("#cartaoNumero").on("input", function () {
                    // Verificando opções de bandeira do cartão e de confirmação da formatação do número
                    var numeroCartao = $(this).val().replace(/\s/g, '');

                    if (numeroCartao.startsWith("1234")) {
                        $("#visaBandeira").show();
                        $("#mastercardBandeira").hide();
                    } else if (numeroCartao.startsWith("4321")) {
                        $("#visaBandeira").hide();
                        $("#mastercardBandeira").show();
                    } else {
                        $("#visaBandeira").hide();
                        $("#mastercardBandeira").hide();
                    }

                    var formatoCartao = /^\d{4}\s\d{4}\s\d{4}\s\d{4}$/;
                    var formatoValido = formatoCartao.test(numeroCartao);

                    if (formatoValido) {
                        $("#mensagemErroCartao").hide();
                    } else {
                        $("#mensagemErroCartao").show().text("Número do cartão inválido. Verifique o formato.");
                    }

                });
                
                // Validador do Formato de Validade do Cartão
                $("#validadeCartao").on("input", function () {
                    var validadeCartao = $(this).val();
                    var formatoValidade = /^(0[1-9]|1[0-2])\/\d{2}$/;

                    const start = Date.now();
                    const dataLegivel = new Date(start);

                    const mes = dataLegivel.getMonth() + 1;
                    const ano = dataLegivel.getFullYear() % 100;

                    const partesData = validadeCartao.split('/');
                    
                    var formatoValido = formatoValidade.test(validadeCartao);
                    const mesCartao = parseInt(partesData[0], 10);
                    const anoCartao = parseInt(partesData[1], 10);

                    if (formatoValido) {
                        if (anoCartao > ano || (anoCartao === ano && mesCartao >= mes)) {
                            $("#mensagemErroValidade").hide();
                        } else {
                            $("#mensagemErroValidade").show().text("Cartão vencido. Por favor, verifique a validade!");
                        }
                    } else {
                        $("#mensagemErroValidade").show().text("Formato de validade inválido. Verifique (mm/aa).");
                    }
                });

                // Verificador do Código de Segurança
                $("#segurancaCodigo").on("input", function () {
                    var codeSecure = $(this).val();
                    var codeFormatted = /^\d{3}$/;

                    if (codeFormatted.test(codeSecure)) {
                        $("#mensagemErroCVV").hide();
                        $(this).removeClass("erro-input").addClass("ok-input");
                    } else {
                        $("#mensagemErroCVV").show().text("Código de segurança inválido. Deve conter exatamente 3 dígitos.");
                        $(this).removeClass("ok-input").addClass("erro-input");
                    }
                });

                $('input[name="metodoPagamento"]').change(function () {
                    var metodoPagamento = $(this).val();

                    $(".secao-pix, .secao-cartao").hide();

                    if (metodoPagamento === "pix") {
                        $(".secao-pix").show();
                    } else if (metodoPagamento === "cartao") {
                        $(".secao-cartao").show();
                    }
                });                
        
                $(".botao-confirmar").click(function () {
                    $(".opcoes-pagamento").hide();
                });
            });

            $(document).ready(function () {
                $("#cpfPix").on("input", function () {
                    var currentValue = $(this).val();

                    var cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
                    if (!cpfRegex.test(currentValue)) {
                        $(this).addClass("erro-cpf");
                    } else {
                        $(this).removeClass("erro-cpf");
                        $(this).addClass("ok-cpf");
                    }
                });

                // Verifica diretamente na tentativa de envio de formulário para saber se o CPF está no formato correto
                $("#formu-pagamento").submit(function (event) {
                    var currentValue = $("#cpfPix").val();

                    // Verifica se o CPF está no formato correto usando uma expressão regular
                    var cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
                    if (!cpfRegex.test(currentValue)) {
                        // O CPF não está no formato correto, impede o envio do formulário
                        alert("CPF inválido! Verifique o formato.");
                        event.preventDefault(); // Impede o envio do formulário
                    }
                });
            });            

        </script>
    </div>
    
    <!-- Definindo o rodapé da página -->
    <div class="rodape">
        <span>Todos os direitos reservados aos desenvolvedores Emylly Guimarães e Felipe Marzani</span>
    </div>

</body>
</html>